Manual dos Contribuintes - Sistema Nacional NFS-e

Guia para utilização das API´s do Emissor Público Nacional

HISTÓRICO DE VERSÕES
Versão Data
1.0

Alterações da Versão

17/03/2025

Resumo do Documento
Descrição:

Este documento contempla informações sobre a utilização das API´s
relacionadas com o Emissor Público Nacional.

Destinação

Atores envolvidos na emissão do documento fiscal: emitente, intermediário
e tomador do serviço.

1. Emissor Público Nacional NFS-e – API (Sefin Nacional NFS-e)
1.1. API Parâmetros Municipais
1.2. Descrição
Através deste serviço um usuário obtém as parametrizações de um município específico. De posse
das informações dos parâmetros de um município o emitente pode preencher as informações
necessárias da DPS para emissão e envio à Sefin Nacional NFS-e, que a validará para gerar a NFSe.
1.2.1. Processamento
a) GET – /parametros_municipais/{codigoMunicipio}/convenio
Consulta os parâmetros do convênio de um município.
b) GET – /parametros_municipais/{ codigoMunicipio}/{codigoServico}
Consulta as alíquotas, regimes especiais de tributação e deduções/reduções por subitens da lista
de serviço.
c) GET – /parametros_municipais/{codigoMunicipio}/{CPF/CNPJ}
Consulta as retenções a que um contribuinte tem o dever de recolher para um município.
d) GET – /parametros_municipais/{codigoMunicipio}/{CPF/CNPJ}
Consulta os benefícios municipais a que um contribuinte tem direito em um município.

1.3. API NFS-e
1.3.1. Descrição
Possui dois serviços:
•

Recepção de um arquivo XML que representa a DPS;

•

Consulta de NFS-e pela chave de acesso;

1.3.2. Métodos
a) POST – /nfse
Geração síncrona de Nota Fiscal de Serviço eletrônica. Através de um método POST a API
recepciona uma DPS emitida pelo contribuinte e enviada pelo solicitante do serviço. A API realiza
validações de negócio sobre a DPS recebida, rejeitando (se a validação não passar em ao menos
uma das regras de negócio definidas para a DPS) ou gerando a NFS-e. O sistema retorna para o
solicitante a mensagem de erro com o motivo da rejeição da validação ou o arquivo XML da NFS-e
gerada com a DPS.
Um caso à parte ocorre quando a DPS enviada contém uma chave de acesso de uma NFS-e já
gerada pelo sistema para ser substituída. A API verifica a existência desta NFS-e e, encontrada, o
sistema realiza os mesmos procedimentos descritos anteriormente para validação da DPS e gera
um Evento de Cancelamento de NFS-e por Substituição. Este evento é vinculado à NFS-e original,
cancelando-a. É gerada a NFS-e substituta e retornado ao solicitante o arquivo XML da NFS-e
gerada com a DPS enviada.
Para o processamento realizado sobre a DPS devem ser compreendidos:
• Esquemas e Leiaute DPS e NFS-e;
• Regras de negócio aplicadas sobre a DPS para gerar a NFS-e;

Estes itens estão disponíveis no AnexoI-LeiautesRN_DPS_NFSe-SNNFSe deste manual.
São também necessários para o processamento realizado na DPS para a geração da NFS-e as
integrações com:
• Parametrizações do convênio do município emissor da NFS-e;
• Parametrizações que o município emissor da NFS-e realiza previamente no Sistema Nacional
NFS-e que são utilizadas nas validações sobre a DPS;
• Informações do cadastro nacional de contribuintes NFS-e;
• Informações das integrações com os cadastros CNPJ, CPF e Simples Nacional;
b) GET – /nfse/{chaveAcesso}
Consulta NFS-e pela chave de acesso. Através de um método GET a API obtém uma NFS-e a partir
de uma chave de acesso como parâmetro na consulta realizada pelo solicitante.

1.4. API DPS
1.4.1. Descrição
Serviço cujo objetivo principal é recuperar a chave de acesso da NFS-e a partir de uma consulta
pelo identificador da DPS (Código IBGE do Município Emissor (7), Tipo de Inscrição (1), Inscrição
Federal (14 - CPF completar com 000 à esquerda), Série DPS (5), Núm. DPS (15). No entanto,
por questões de sigilo fiscal, a chave de acesso será informada somente se a identificação do
usuário do certificado digital da conexão solicitante for um ator (Prestador, Tomador ou
Intermediário) que consta na NFS-e gerada a partir da DPS consultada.
1.4.2. Métodos
O processamento se dá em dois métodos distintos com objetivos separados, Get e Head. Realiza
uma consulta ao banco de dados da Sefin Nacional NFS-e com os parâmetros da DPS informados,
retornando a chave de acesso da NFS-e correspondente à DPS consultada ou somente a informação
de que a NFS-e referente à DPS consultada foi gerada, sem informar a chave de acesso.
a) GET – /dps/{id}
Recupera a chave de acesso da NFS-e a partir do identificador do DPS. O solicitante informa a
identificação da DPS e a API retorna a chave de acesso da NFS-e correspondente. Somente podem
ser consultados identificadores de DPS emitidos através Sefin Nacional NFS-e e desde que a
identificação do certificado digital da conexão solicitante corresponda a um dos atores informados
na DPS da NFS-e (Prestador, Tomador ou Intermediário). Caso contrário a solicitação será negada.
b) HEAD – /dps/{id}
O método Head é uma consulta para informar se uma NFS-e foi gerada ou não a partir do
identificador da DPS. Este método atende a qualquer usuário desde que realize a consulta com um
certificado digital válido.

1.5. API Eventos
1.5.1. Descrição
Recepciona os Pedidos de Registros de Eventos de NFS-e gerados e enviados para a API, realiza
validações de negócio sobre estes pedidos e gera o Evento solicitado. O evento gerado é vinculado
à NFS-e para a qual o pedido de registro de evento foi enviado.
1.5.2. Métodos
Para o processamento realizado sobre o Pedido de Registro de Evento devem ser compreendidos:
•
•

Esquemas relativos aos eventos reconhecidos pelo Sistema Nacional NFS-e;
Leiaute do Pedido de Registro de Evento de NFS-e;

•
•
•
•

Leiaute do Evento de NFS-e;
Regras de negócio aplicadas sobre o pedido de registro de evento;
Parametrizações que o município emissor da NFS-e realiza previamente para utilização nas
validações sobre o Pedido de Registro de Evento de NFS-e;
Estes itens e todas as regras e observações de negócio para todos os eventos de NFS-e do
Sistema Nacional NFS-e estão anotadas e disponíveis nas planilhas do arquivo AnexoIILeiautesRN_Eventos-SNNFSe deste manual.

O processo de transação completa de utilização dos eventos de NFS-e tem a seguinte sequência:
1. O solicitante envia o pedido de registro de evento;
2. O sistema valida, registra ou rejeita o pedido de registro de evento;
3. O sistema, caso aceite o pedido de registro de evento, gera o evento de NFS-e que ficará
vinculado ao documento da nota, cuja chave de acesso da NFS-e estiver informada no
pedido;
4. O sistema envia comunicação de aceite ou rejeição do pedido de registro de evento ao
solicitante;
a) POST – /nfse/{chaveAcesso}/eventos
É um modelo genérico que permite o registro de eventos originados a partir de: Emitentes da NFSe; Não Emitentes da NFS-e; Município Emissor; Município de Incidência e do Módulo de Apuração
Nacional;
Um evento é o registro de um fato relacionado a uma NFS-e. Esse evento pode ou não modificar a
situação do documento (por exemplo: cancelamento de NFS-e) ou simplesmente dar ciência sobre
a confirmação da prestação de serviço pelo tomador (por exemplo: Manifestação de NFS-e Confirmação).
O serviço para registro de eventos será disponibilizado pelas Sefins geradoras de NFS-e (Sefin
Nacional e demais Sefins municipais que desejarem seguir o padrão nacional para NFS-e) através
de um processamento síncrono na API Eventos. Assim como as NFS-e, os eventos são um tipo de
documento fiscal eletrônico e serão compartilhados pelo ADN NFS-e conforme regras de visibilidade
de documentos. As mensagens de comunicação com a API utilizarão o padrão JSON, já definido
para o projeto NFS-e, enquanto o leiaute do DF-e utiliza o padrão XML contendo a assinatura digital
do emissor do evento.
Para o registro do evento é necessário a existência da NFS-e na Sefin geradora de NFS-e, em
conformidade com as regras de negócio estabelecidas para os eventos de NFS-e.
O modelo de mensagem do evento deverá ter um conjunto mínimo de informações comuns, a
saber:
• Identificação do autor da mensagem;
• Identificação do evento;
• Identificação da NFS-e vinculada;
• Informações específicas do evento;
• Assinatura digital da mensagem;
A API de eventos será única com a funcionalidade de tratar eventos de forma genérica para facilitar
a criação de novos eventos sem a necessidade de criação de novos serviços e com poucas alterações
na aplicação de Pedido de Registro de Eventos da Sefin geradora de NFS-e.
O leiaute da mensagem do Pedido de Registro de Evento seguirá o modelo, contendo uma parte
genérica (comum a todos os tipos de evento) e uma parte específica onde será inserido o XML
correspondente a cada tipo de evento.
As regras de validação referentes às partes genérica e específica dos eventos estão descritas em
tabela específica no AnexoII-LeiautesRN_Eventos-SNNFSe.
b) GET – /nfse/{chaveAcesso}/eventos
Consulta eventos por chave de acesso. O solicitante informa a chave de acesso de uma NFS-e e a
API retorna todos os eventos vinculados à chave de acesso de NFS-e informada na consulta.

c) GET – /nfse/{chaveAcesso}/eventos/{tipoEvento}
Consulta eventos por chave de acesso e tipo. O solicitante informa a chave de acesso e o tipo de
evento (código identificador do evento). A API retorna o(s) evento(s) do tipo especificado
vinculado(s) à chave de acesso de NFS-e informada na consulta.
d) GET – /nfse/{chaveAcesso}/eventos/{tipoEvento}/{numSeqEvento}
Consulta eventos por chave de acesso, tipo e sequencial do evento. O solicitante informa a chave
de acesso, o tipo de evento (código identificador do evento) e o número sequencial específico do
tipo de evento desejado (caso o tipo de evento permita mais de um evento do mesmo tipo para a
mesma nota, caso contrário o número sequencial deve ser igual a 1). A API retorna exatamente o
evento com o número sequencial solicitado, do tipo especificado, vinculado à chave de acesso de
NFS-e informada na consulta.

1.6. Ambiente de produção restrita
Foi disponibilizada uma Swagger em ambiente de produção restrita destinada a testes por parte
dos municípios conveniados.

Link ambiente de produção restrita:
https://adn.producaorestrita.nfse.gov.br/contribuintes/docs/index.html

